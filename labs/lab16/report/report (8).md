---
## Front matter
title: "Отчёт по лабораторной работе №16"
subtitle: "Программный RAID"
author: "Анна Саенко"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы  

Освоить работу с RAID-массивами при помощи утилиты mdadm.

# Ход выполнения работы  

## Проверка доступных дисков  

Сначала были получены полномочия администратора и выполнена проверка доступных дисков при помощи команды `fdisk -l | grep /dev/sd`.  
На скриншоте видно, что в системе присутствуют устройства **/dev/sdd**, **/dev/sde**, **/dev/sdf**.

Для каждого диска был создан один раздел с использованием утилиты `sfdisk`.  
Ниже показан пример создания раздела для диска `/dev/sdd`. Аналогичные действия были выполнены для `/dev/sde` и `/dev/sdf`.

![Создание разделов через sfdisk](Screenshot_1.png){ #fig:001 width=80% }

После разметки дисков были проверены типы созданных разделов.  
Все разделы имели тип **83 — Linux**, что подтверждается выводом утилиты `sfdisk`.

Для уточнения доступных типов RAID использовалась команда `sfdisk -T`.  
В результате был найден нужный тип — **fd (Linux raid autodetect)**.

Тип разделов на всех трёх дисках был изменён на **fd**.  
После выполнения команд таблица разделов успешно обновилась.

![Изменение типа разделов](Screenshot_2.png){ #fig:002 width=80% }

При помощи `sfdisk -l` были просмотрены таблицы разделов каждого диска.  
Все разделы имеют тип **fd — Linux raid autodetect**.

![Состояние диска sdd](Screenshot_3.png){ #fig:003 width=80% }

## Создание RAID-массива уровня 1  

При помощи утилиты `mdadm` был создан RAID-массив уровня **RAID 1** из двух дисков — `/dev/sdd1` и `/dev/sde1`.  
Массив успешно инициирован.

![Создание RAID-массива](Screenshot_4.png){ #fig:004 width=80% }

Состояние массива просматривалось через `/proc/mdstat`, `mdadm --query` и `mdadm --detail`.  
Массив находится в состоянии **clean**, оба устройства работают в синхронном режиме.

![Состояние RAID-массива](Screenshot_5.png){ #fig:005 width=80% }

На RAID-массиве была создана файловая система EXT4.  
Далее RAID был смонтирован в каталог `/data/mnt`.

![Создание ФС и монтирование](Screenshot_6.png){ #fig:006 width=80% }

В файл `/etc/fstab` была добавлена строка для автоматического монтирования массива при загрузке системы.

![Редактирование fstab](Screenshot_7.png){ #fig:007 width=80% }

Был искусственно вызван сбой диска `/dev/sde1`, после чего диск был удалён из массива.  
На его место был добавлен новый диск — `/dev/sdf1`.  
После восстановления массив вновь оказался в состоянии **clean**.

![Сбой, замена диска и восстановление массива](Screenshot_8.png){ #fig:008 width=80% }

RAID был размонтирован, остановлен, после чего суперблоки всех RAID-разделов были очищены.

![Удаление и очистка массива](Screenshot_9.png){ #fig:009 width=80% }

## Создание RAID-массива с горячим резервом (hot spare)

Был создан массив RAID 1 на устройствах `/dev/sdd1` и `/dev/sde1`.  
Система предупредила, что используется новая версия метаданных, после чего массив был успешно создан.

![Создание RAID 1](Screenshot_10.png){ #fig:010 width=80% }

К массиву был добавлен третий диск — `/dev/sdf1`, который автоматически стал hot spare.

![Добавление hot spare](Screenshot_11.png){ #fig:011 width=80% }

Был выполнен монтаж массива `/dev/md0`.

Состояние массива после добавления hot spare:

- RAID-уровень: **raid1**  
- Активные устройства: 2  
- Рабочие устройства: 3  
- Один диск находится в роли **spare**  

Явно вызван отказ диска `/dev/sde1`.

![Отказ диска](Screenshot_12.png){ #fig:012 width=80% }

После отказа произошла автоматическая перестройка массива: диск `sdf1` стал активным.

Состояние массива:  

- Active devices: 2  
- Working devices: 2  
- Failed devices: 1  
- Spare devices: 0  

Массив был размонтирован, остановлен и очищен от метаданных.

![Очистка суперблоков](Screenshot_13.png){ #fig:013 width=80% }

## Преобразование RAID 1 в RAID 5

Вновь создаётся RAID 1 и добавляется третий диск.

![Создание RAID 1 и добавление диска](Screenshot_14.png){ #fig:014 width=80% }

![Проверка статуса массива](Screenshot_15.png){ #fig:015 width=80% }

Состояние после создания:

- RAID-уровень: **raid1**
- Total devices: 3
- Spare devices: 1

Изменён тип массива

После преобразования RAID стал **raid5**, но использует всё ещё два диска и один spare.

![Преобразование в RAID 5](Screenshot_16.png){ #fig:016 width=80% }

в массив был включён третий диск.

Результат:

- RAID-уровень: **raid5**
- Active devices: 3  
- Spare devices: 0  
- Размер массива увеличился вдвое  

![RAID 5 после добавления третьего диска](Screenshot_17.png){ #fig:017 width=80% }

Массив был размонтирован, остановлен и суперблоки очищены.

![Очистка RAID 5](Screenshot_18.png){ #fig:018 width=80% }

Строка автомонтирования была закомментирована:

![fstab с закомментированной строкой](Screenshot_19.png){ #fig:019 width=80% }

# Контрольные вопросы

1. **Приведите определение RAID.**
   RAID (Redundant Array of Independent Disks) — это технология, позволяющая объединять несколько физических дисков в единый логический массив. Основная цель RAID — повысить производительность, надёжность хранения данных или одновременно обеспечить оба свойства. В зависимости от уровня RAID данные распределяются по дискам особым образом, что позволяет организовать избыточность, ускорение доступа или сочетание этих преимуществ.

2. **Какие типы RAID-массивов существуют на сегодняшний день?**
   Наиболее распространённые уровни RAID включают:

   * **RAID 0** — чередование (striping) без избыточности
   * **RAID 1** — зеркалирование (mirroring)
   * **RAID 5** — распределённая контрольная сумма (distributed parity)
   * **RAID 6** — двойная избыточность (dual parity)
   * **RAID 10 (1+0)** — комбинация зеркалирования и чередования
   * **RAID 50, RAID 60** — комбинации массивов верхнего уровня
   * **JBOD** — не является RAID, но используется как линейное объединение дисков

3. **Охарактеризуйте RAID 0, RAID 1, RAID 5, RAID 6, опишите алгоритм работы, назначение и приведите примеры применения.**

   **RAID 0 (striping)**

   * **Алгоритм работы:** данные разбиваются на блоки и записываются попеременно на несколько дисков.
   * **Назначение:** максимальное увеличение скорости чтения и записи.
   * **Преимущества:** высокая производительность, использование полного объёма всех дисков.
   * **Недостатки:** отсутствие отказоустойчивости — выход любого диска приводит к потере всего массива.
   * **Применение:** обработка больших объёмов данных, видеомонтаж, временные высокоскоростные хранилища.

   **RAID 1 (mirroring)**

   * **Алгоритм работы:** одни и те же данные дублируются на два (или больше) диска.
   * **Назначение:** обеспечение максимальной надёжности хранения данных.
   * **Преимущества:** высокая отказоустойчивость — при выходе одного диска массив продолжает работать.
   * **Недостатки:** фактическая потеря половины ёмкости, так как данные хранятся в двух копиях.
   * **Применение:** серверы баз данных, критически важные системы, где первична сохранность информации.

   **RAID 5 (striping + distributed parity)**

   * **Алгоритм работы:** данные и контрольные суммы (parity) распределяются по всем дискам массива.
   * **Назначение:** сочетание скорости и надёжности при эффективном использовании дискового пространства.
   * **Преимущества:** отказоустойчивость при выходе одного диска, увеличение скорости чтения.
   * **Недостатки:** снижение скорости записи из-за вычисления контрольных сумм; восстановление после сбоя может занимать много времени.
   * **Применение:** файловые серверы, сетевые хранилища, корпоративные архивы.

   **RAID 6 (dual parity)**

   * **Алгоритм работы:** данные распределяются по дискам, а также записываются две независимые контрольные суммы, что позволяет выдерживать два отказа одновременно.
   * **Назначение:** максимальная устойчивость массива к отказам при большом количестве дисков.
   * **Преимущества:** выдерживает выход сразу двух дисков.
   * **Недостатки:** ещё более низкая скорость записи по сравнению с RAID 5; требуется минимум четыре диска.
   * **Применение:** крупные сетевые хранилища, системы резервного копирования, где критична высокая надёжность.

# Заключение  

В ходе выполнения лабораторной работы я освоила практическую работу с технологией RAID и научилась применять инструменты для создания, управления и диагностики программных RAID-массивов в Linux.  

В рамках работы были выполнены следующие действия:  
- создание массива RAID 1 и добавление к нему диска в роли hot spare;  
- проверка состояния массива, анализ информации из `/proc/mdstat` и утилиты `mdadm`;  
- симуляция отказа одного из дисков и наблюдение автоматического восстановления массива с использованием горячего резерва;  
- удаление массива и очистка суперблоков всех задействованных устройств;  
- создание RAID 1, его преобразование в RAID 5 и последующее расширение массива за счёт увеличения числа активных устройств;  
- изучение поведения RAID 5 при изменении уровня и структуры массива, а также диагностика состояния после перестройки;  
- корректировка записи в файле `/etc/fstab` для управления автомонтированием.  

Выполнение лабораторной работы позволило глубже понять принципы избыточности данных, механизмы устойчивости к отказам и алгоритмы работы различных уровней RAID. Полученные навыки являются важными для обеспечения надежности и производительности дисковых подсистем в серверных и корпоративных системах хранения данных.  
